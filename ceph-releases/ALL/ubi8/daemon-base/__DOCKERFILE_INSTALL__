microdnf update -y --setopt=install_weak_deps=0 --nodocs && \
microdnf install -y --setopt=install_weak_deps=0 --nodocs wget unzip util-linux python3-saml python3-setuptools udev device-mapper __CEPH_BASE_PACKAGES__ && \
ln -s /usr/share/ceph/mgr/dashboard/frontend/dist-ibm /usr/share/ceph/mgr/dashboard/frontend/dist && \
sed -i \
  -e "s|registry.redhat.io/rhceph/rhceph-5-rhel8:latest|icr.io/ibm-ceph/ceph-5-rhel8|" \
  -e "s|registry.redhat.io/openshift4/ose-prometheus:v4.10|icr.io/ibm-ceph/prometheus:v4.10|" \
  -e "s|registry.redhat.io/openshift4/ose-prometheus-node-exporter:v4.10|icr.io/ibm-ceph/prometheus-node-exporter:v4.10|" \
  -e "s|registry.redhat.io/rhceph/rhceph-5-dashboard-rhel8:latest|icr.io/ibm-ceph/ceph-5-dashboard-rhel8:latest|" \
  -e "s|registry.redhat.io/openshift4/ose-prometheus-alertmanager:v4.10|icr.io/ibm-ceph/prometheus-alertmanager:v4.10|" \
  -e "s|registry.redhat.io/rhceph/rhceph-haproxy-rhel8:latest|icr.io/ibm-ceph/haproxy-rhel8:latest|" \
  -e "s|registry.redhat.io/rhceph/keepalived-rhel8:latest|icr.io/ibm-ceph/keepalived-rhel8:latest|" \
  -e "s|registry.redhat.io/rhceph/snmp-notifier-rhel8:latest|icr.io/ibm-ceph/snmp-notifier-rhel8:latest|" \
  -e "s|default='registry.redhat.io'|default='icr.io'|" \
  /usr/share/ceph/mgr/cephadm/module.py
